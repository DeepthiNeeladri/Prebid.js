<!--
  This page exists to test a video ad, end-to-end.
-->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Prebid.js video adUnit example</title>

    <!-- videojs -->
    <link rel="stylesheet" href="http://vjs.zencdn.net/5.9.2/video-js.css">
    <script type="text/javascript" src="http://vjs.zencdn.net/5.9.2/video.js"></script>

    <!-- videojs-vast-vpaid -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/videojs-vast-vpaid/2.0.2/videojs.vast.vpaid.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-vast-vpaid/2.0.2/videojs_5.vast.vpaid.min.js"></script>

    <!-- prebid.js -->
    <script src="../../build/dev/prebid.js" async=true></script>


    <script>

      var pbjs = pbjs || {};
      pbjs.que = pbjs.que || [];

      /*
       Prebid Video adUnit
       */

      var videoAdUnit = [{
  code: 'video1',
  sizes: [640, 480],
  mediaTypes: {
    video: {
      context: "instream"
    }
  },
  bids: [{
    bidder: 'oneVideo',
    params: {
      video: {
        playerWidth: 480,
        playerHeight: 640,
        mimes: ['video/mp4', 'application/javascript'],
        protocols: [2, 5],
        api: [2],
        delivery: [2],
        playbackmethod: [1, 5],
        placement: 1,
        //inventoryid: 34567,
        position: 1
        //display: 1
      },
      site: {
        id: 1,
        page: 'https://www.yahoo.com',
        referrer: 'http://abhi12345.com'

      },
      pubId: 'brxd',
      bidfloor: 10
    }
  }]
}];

      pbjs.que.push(function(){
        pbjs.setConfig({
   consentManagement: {
     cmpApi: 'static',
     timeout: 1111,
     allowAuctionWithoutConsent: false,
     consentData: {
       getConsentData: {
         'gdprApplies': true,
         'hasGlobalScope': false,
         'consentData': 'BOOgjO9OOgjO9APABAENAi-AAAAWd7_______9____7_9uz_Gv_r_ff_3nW0739P1A_r_Oz_rm_-zzV44_lpQQRCEA'
       },
       getVendorConsents: {
         'metadata': 'BOOgjO9OOgjO9APABAENAi-AAAAWd7_______9____7_9uz_Gv_r_ff_3nW0739P1A_r_Oz_rm_-zzV44_lpQQRCEA'

       }
     }
   }
 });
        // pbjs.setConfig({
        //   consentManagement: {
        //     cmpApi: 'iab',
        //     timeout: 1111,
        //     allowAuctionWithoutConsent: 'cancel'
        //   }
        // });
        pbjs.addAdUnits(videoAdUnit);
        pbjs.requestBids({
          timeout : 700,
          bidsBackHandler : function(bids) {
            var videoUrl = pbjs.adServers.dfp.buildVideoUrl({
              adUnit: videoAdUnit,
              params: {
                iu: '/19968336/prebid_cache_video_adunit'
              }
            });

            invokeVideoPlayer(videoUrl);
          }
        });
      });

      pbjs.bidderSettings =
        {
          standard: {
            adserverTargeting: [
              {
                key: "hb_bidder",
                val: function (bidResponse) {
                  return bidResponse.bidderCode;
                }
              }, {
                key: "hb_adid",
                val: function (bidResponse) {
                  return bidResponse.adId;
                }
              }, {
                key: "hb_pb",
                val: function (bidResponse) {
                  return "10.00";
                }
              }, {
                key: "hb_size",
                val: function (bidResponse) {
                  return bidResponse.size;

                }
              }
            ]
          }
        };
    </script>
</head>

<body>

<h2>Prebid Video -- video.js</h2>

<div class="example-video-container">

    <video id="vid1" class="video-js vjs-default-skin vjs-big-play-centered" controls
           data-setup='{}'
           width='640'
           height='480'
    >
        <source src="http://vjs.zencdn.net/v/oceans.mp4" type='video/mp4'/>
        <source src="http://vjs.zencdn.net/v/oceans.webm" type='video/webm'/>
        <source src="http://vjs.zencdn.net/v/oceans.ogv" type='video/ogg'/>

    </video>
</div>

<script>
  function invokeVideoPlayer(url) {
    videojs("vid1").ready(function() {
      this.vastClient({
        adTagUrl: url,
        playAdAlways: true,
        verbosity: 4,
        vpaidFlashLoaderPath: "https://github.com/MailOnline/videojs-vast-vpaid/blob/RELEASE/bin/VPAIDFlash.swf?raw=true",
        autoplay: true
      });

      this.muted(true);
      this.play();
    });
  }

</script>
</body>
</html>
